<script src="<%= Settings.asset_prefix %>/bower_components/jsbelt/lib/belt.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/underscore/underscore-min.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/underscore.string/dist/underscore.string.min.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/async/dist/async.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/moment/min/moment.min.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/query-object/query-object.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/jquery/dist/jquery.min.js" type="text/javascript" charset="utf-8"></script>

<script src="<%= Settings.asset_prefix %>/bower_components/simple-scrollTo/lib/scrollTo.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/slick-carousel/slick/slick.min.js"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/sticky-kit/jquery.sticky-kit.min.js"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/isotope/dist/isotope.pkgd.min.js"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/aos/dist/aos.js"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/tether/dist/js/tether.min.js"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/backbone/backbone-min.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/bootheel/bootheel.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.lazy/1.7.4/jquery.lazy.min.js"></script>
<script type="text/javascript" src="<%= Settings.asset_prefix %>/public/assets/vendors/cloudzoom/cloudzoom.js"></script>

<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>

<script type="text/javascript">
  var Async = async
    , Moment = moment
    , Str = s
    , GB = GB || {};

  <% if (typeof doc !== 'undefined'){ %>
    GB['doc'] = <%= Belt.stringify(doc) %>;
  <% } %>
  <% if (typeof docs !== 'undefined'){ %>
    GB['docs'] = <%= Belt.stringify(docs) %>;
  <% } %>
  <% if (typeof count !== 'undefined'){ %>
    GB['count'] = <%= count %>;
  <% } %>
  <% if (typeof skip !== 'undefined'){ %>
    GB['skip'] = <%= skip %>;
  <% } %>
  <% if (typeof limit !== 'undefined'){ %>
    GB['limit'] = <%= limit %>;
  <% } %>
  <% if (typeof query !== 'undefined'){ %>
    GB['query'] = <%= Belt.stringify(query) %>;
  <% } %>
  <% if (typeof search_query !== 'undefined'){ %>
    GB['search_query'] = "<%= search_query %>";
  <% } %>
  <% if (typeof category !== 'undefined'){ %>
    GB['category'] = "<%= category %>";
  <% } %>
  <% if (typeof configuration !== 'undefined'){ %>
    GB['configuration'] = <%= Belt.stringify(configuration) %>;
  <% } %>
  <% if (typeof configuration_options !== 'undefined'){ %>
    GB['configuration_options'] = <%= Belt.stringify(configuration_options) %>;
  <% } %>
  <% if (typeof sort !== 'undefined'){ %>
    <% if (_.isObject(sort)){ %>
      GB['sort'] = <%= Belt.stringify(sort) %>;
    <% } else { %>
      GB['sort'] = "<%= sort %>";
    <% } %>
  <% } %>
  <% if (typeof Settings.localities !== 'undefined'){ %>
    GB['localities'] = <%= Belt.stringify(Settings.localities) %>;
  <% } else { %>
    GB['localities'] = {};
  <% } %>
</script>

<script src="<%= Settings.asset_prefix %>/public/js/util.js" type="text/javascript" charset="utf-8"></script>
<script src="/templates.js" type="text/javascript" charset="utf-8"></script>
<script src="<%= Settings.asset_prefix %>/public/assets/javascript/scripts.js"></script>

<% if (typeof js_files !== 'undefined') _.each(js_files, function(e){ %>
  <script src="<%= e %>" type="text/javascript" charset="utf-8"></script>
<% }) %>

<% if (true || Settings.environment === 'production'){ %>
  <script type="text/javascript">
  var google_tag_params = {};

  <% if (typeof prod_id !== 'undefined'){ %>
    <% if (_.isString(prod_id)){ %>
      google_tag_params['ecomm_prodid'] = '<%= prod_id %>';
    <% } else { %>
      google_tag_params['ecomm_prodid'] = <%= Belt.stringify(prod_id) %>;
    <% } %>
  <% } %>
  <% if (typeof page_type !== 'undefined'){ %>
    google_tag_params['ecomm_pagetype'] = '<%= page_type %>';
  <% } %>
  <% if (typeof total_value !== 'undefined'){ %>
    google_tag_params['ecomm_totalvalue'] = <%= total_value %>;
  <% } %>
  </script>
  <script type="text/javascript">
  /* <![CDATA[ */
  var google_conversion_id = 835244551;
  var google_custom_params = window.google_tag_params;
  var google_remarketing_only = true;
  /* ]]> */
  </script>
  <script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
  </script>
  <noscript>
  <div style="display:inline;">
  <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/835244551/?guid=ON&amp;script=0"/>
  </div>
  </noscript>
<% } %>

<script>
  if (GAEnabled()) ga('send', 'pageview');
</script>

<% if (!Belt.get(Request, 'session.viewed_subscribe_modal') && Belt.random_int(0, 4) === 2){ %>
  <% Request.session['viewed_subscribe_modal'] = true; %>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
      setTimeout(function(){
        $('.modal').modal('show');
        $.getJSON('/email/modal/viewed.json', Belt.np);

        if (GAEnabled()) ga('send', 'event', 'ShowSubscribeModal');

        if (FBEnabled()) fbq('trackCustom', 'show_email_modal', {

        });

      }, 2000);
    });
  </script>
<% } %>
