<tr class="order" data-id="<%= _id %>">
  <td>
    <p><%= slug %></p>
    <% if (typeof support_status !== 'undefined' && support_status){ %>
      <p><span class="label label-info"><%= support_status %></span></p>
    <% } %>
    <% if (shipping_status !== 'shipped'){ %>
      <p><span class="label label-warning">NOT SHIPPED</span></p>
    <% } else { %>
      <p><span class="label label-success">SHIPPED</span></p>
    <% } %>
    <% if (typeof notes !== 'undefined' && notes){ %>
      <p>NOTES: <%= notes.replace(/\n/g, "</p><p>") %></p>
    <% } %>
    <p>
      <a href="/admin/order/<%= _id %>/read" class="btn btn-default">Edit</a>
    </p>
  </td>
  <td>
    <%= Moment(created_at).format('MM/DD/YYYY hh:mm a') %>
  </td>
  <td>
    <% _.each(buyer, function(v, k){ %>
      <p><%= k %>: <strong><%= v %></strong></p>
    <% }) %>
  </td>
  <td>
    <% _.each(recipient, function(v, k){ %>
      <p><%= k %>: <strong><%= v %></strong></p>
    <% }) %>
  </td>
  <td>
    <% _.each(transactions, function(v){ %>
      <p><%= v.type %>: <strong>$<%= Instance.priceString(v.amount) %></strong><br><%= Moment(v.created_at).format('MM/DD/YYYY hh:mm a') %><br><%= v.id %></p>
    <% }) %>
  </td>
  <td>
    <% _.each(line_items, function(v, k){ %>
      <p>
      <%= v.label %> - $<%= Instance.priceString(v.amount) %>
      </p>

      <hr>
    <% }) %>
  </td>
  <td>
    <% _.each(vendor_products, function(v2, k){ %>
      <% if (Instance.vendor_ids[k]){ %>
        <p>
          <span class="label label-info"
            <% if (Belt.get(Instance.vendor_ids[k], 'shopify.access_token')){ %>
              title="Shopify vendor: no manual handling needed."
            <% } else if (Belt.get(Instance.vendor_ids[k], 'woocommerce.consumer_key')){ %>
              title="Woocommerce vendor: email vendor to alert them to order. They have received it in their API, but we need to make sure they have all info needed. Shipping will need to be entered manually."
            <% } else { %>
              title="Manaul vendor: order must be placed manually and shipping notifications must be manually entered."
            <% } %>
          ><%= Instance.vendor_ids[k].name %></span>
        </p>
      <% } %>
      <% _.each(v2, function(v){ %>
        <p>
          <a href="/product/<%= v.source.product.slug %>" target="_blank">
            <%= v.source.product.label.us %> | <%= v.source.product.brands.join(', ') %>
            <br><%= v._id %>
          </a>
        </p>
        <p><%= _.map(v.options, function(v2, k2){ return k2 + ': ' + v2; }).join(', ') %></p>
        <p>QTY: <%= v.quantity %> | UNIT: $<%= Instance.priceString(v.unit_price) %> | TOTAL: $<%= Instance.priceString(v.price) %></p>
        <% if (Belt.get(Instance.vendor_ids[k], 'name') === 'Streetammo' && Belt.get(v, 'source.product.source.record.url')){ %>
          <p>
            <a href="<%= Belt.get(v, 'source.product.source.record.url') %>" target="_blank">Streetammo URL</a>
          </p>
        <% } %>
        <p>
          <% if (_.some(shipped_products, function(p){
            return p.toString() === v._id.toString();
          })){ %>
            <span class="label label-success">SHIPPED</span>
          <% } else { %>
            <% if (Moment().subtract(48, 'hours').isAfter(created_at)){ %>
              <span class="label label-danger">NOT SHIPPED FOR OVER 48 HOURS! CONTACT VENDOR!</span>
            <% } else { %>
              <span class="label label-danger">NOT SHIPPED</span>
            <% } %>
          <% } %>
        </p>
        <% if (v.source.order){ %>
          <p>
            <span class="label label-success">Order #<%= Belt.get(v, 'source.order.order.id') %></span>
          </p>
        <% } %>
      <% }) %>
      <hr>
    <% }) %>
  </td>
  <td>
    <% _.each(vendor_orders, function(v2, k){ %>
      <% if (Instance.vendor_ids[k]){ %>
        <p>
          <span class="label label-danger"><%= Instance.vendor_ids[k].name %></span>
        </p>
      <% } %>
      <% _.each(v2, function(v){ %>
        <p>Order #<%= Belt.get(v, 'order.id') %></p>
        <p>Total Price $<%= Belt.get(v, 'order.total_price') || Belt.get(v, 'order.total') %></p>
        <% _.each(Belt.get(v, 'order.line_items'), function(i){ %>
          <p><%= i.name %> (SKU #<%= i.sku %>, QTY: <%= i.quantity %>, PRICE: $<%= i.price %>)</p>
        <% }) %>
        <% _.each(Belt.get(v, 'order.fulfillments'), function(f){ %>
          <p>
            <span class="label label-info"><%= Belt.arrayDefalse([f.tracking_company, f.tracking_number]).join(' - ') %></span>
          </p>
        <% }) %>
      <% }) %>
      <hr>
    <% }) %>
  </td>
  <td>
    <% _.each(shipments, function(v2, k){ %>
      <p>
        <a href="<%= v2.tracking_url %>" target="_blank"><%= v2.carrier %> - <%= v2.tracking_number %></a> <span class="label label-success"><%= v2.status %></span>
      </p>
      <ul>
        <% _.each(v2.products, function(p){ %>
          <% p = _.find(products, function(p2){ return p2._id.toString() === p; }); %>
          <% if (!p) return; %>
          <li><%= Belt.get(p, 'source.product.label.us') %> (<%= p._id %>)</li>
        <% }) %>
      </ul>
      <hr>
    <% }) %>
  </td>
  <td data-set="actions" data-set-method="html">
    <a href="/admin/order/<%= _id %>/read" class="btn btn-default">Edit</a>
  </td>
</tr>
