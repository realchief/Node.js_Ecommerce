<aside class="aside">
  <% var cats = typeof doc !== 'undefined' && doc._id && Instance.set_categories[doc._id] ? Instance.set_categories[doc._id] : Instance.categories; %>
  <% _.each(cats, function(v, k){ %>
    <% if (!_.size(v)) return; %>
    <ul class="list aside__item">
      <li class="list__item list__title">
        <% if (typeof search_query !== 'undefined'){ %>
          <a href="/products/search?q=<%= encodeURIComponent(search_query) %>&category=<%= encodeURIComponent(k) %>" data-category="<%= k %>" class="list__link"><%= k %></a>
        <% } else { %>
          <a href="/products/category/<%= encodeURIComponent(k) %>" data-category="<%= k %>" class="list__link"><%= k %></a>
        <% } %>
      </li>
      <li class="list__item">
        <% if (typeof search_query !== 'undefined'){ %>
          <a href="/products/search?q=<%= encodeURIComponent(search_query) %>&category=<%= encodeURIComponent(k) %>" data-category="<%= k %>" class="list__link">All <%= k %></a>
        <% } else { %>
          <a href="/products/category/<%= encodeURIComponent(k) %>" data-category="<%= k %>" class="list__link">All <%= k %></a>
        <% } %>
      </li>
      <% _.each(v, function(v2, k2){ %>
        <li class="list__item">
          <% if (typeof search_query !== 'undefined'){ %>
            <a href="/products/search?q=<%= encodeURIComponent(search_query) %>&category=<%= encodeURIComponent(k + ' > ' + k2) %>" data-category="<%= k + ' > ' + k2 %>" class="list__link"><%= k2 %></a>
          <% } else { %>
            <a href="/products/<%= encodeURIComponent(k) %>/<%= encodeURIComponent(k2) %>" data-category="<%= k + ' > ' + k2 %>" class="list__link"><%= k2 %></a>
          <% } %>
        </li>
      <% }) %>
    </ul>
  <% }) %>
</aside>
